---
title: "Rapport"
author: "Florian CROCHET"
format:
  html:
    toc: true
    toc-title: Sommaire
    code-fold: true
    echo: true
    eval: true
    incremental: true
    fig-width: 14
    fig-height: 10
    fig-align: "center"
  pdf:
    echo: true
    eval: true
    fig-width: 14
    fig-height: 10
    fig-align: "center"
params:
  code_commune: 44109  # Valeur par défaut
  code_departement: 44  # Valeur par défaut
  dataframe_name: df_gers_loire_atlantique # Valeur par défaut
  dataframe_path: NULL
---

\newpage
# Introduction

Ce rapport propose une exploration statistique et graphique des données concernant les élus d’une commune et d’un département. Il vise à décrire leurs caractéristiques démographiques et socio-professionnelles à partir d’indicateurs synthétiques tels que la distribution des âges et la répartition par catégorie d’activité. Il applique automatiquement la même analyse à la commune et au département.


\newpage
# Installation et chargement du package

```{r}
# Installation depuis GitHub
# remotes::install_github("floriancrochet/firstlibflorian", quiet = TRUE)

# Chargement
library(firstlibflorian)
```


\newpage
# Chargement des données

```{r}
if (params$dataframe_name == "df_gers_loire_atlantique") {
  # Jeu de données du package
  data <- df_gers_loire_atlantique
} else {
  # Jeu de données en paramètre
  data <- readRDS(normalizePath(params$dataframe_path, winslash = "/", mustWork = TRUE))
}
```


\newpage
## Sélection d'une commune ou d'un département

```{r}
# Fonction qui extrait les données correspondant à une commune dans la base,
# puis leur assigne la classe 'commune'

selection_commune <- function(code_commune, df = data) {
  
  if (!(code_commune %in% df$`Code de la commune`)) {
    stop("Aucune commune trouvée avec ce code.")
  }
  
  selection <- df |>
    dplyr::filter(`Code de la commune` == code_commune) |> 
    creer_commune()
  
  return(selection)
}


# Fonction qui extrait les données correspondant à un département dans la base,
# puis leur assigne la classe 'departement'

selection_departement <- function(code_departement, df = data) {
  
  if (!(code_departement %in% df$`Code du département`)) {
    stop("Aucun département trouvé avec ce code.")
  }
  
  selection <- df |>
    dplyr::filter(`Code du département` == code_departement) |>
    creer_departement()
  
  return(selection)
}
```


\newpage
# Commune

## Sélection de la commune

```{r}
df_commune <- selection_commune(
  params$code_commune
)
```


\newpage
## Statistiques de la commune

```{r}
summary(df_commune)
```


\newpage
## Répartition des élus de la commune par catégorie socio-professionnelle

```{r}
plot_commune <- plot(df_commune)
plot_commune$graphique_sans_legende
plot_commune$legende
```


\newpage
# Département

## Sélection du département

```{r}
df_departement <- selection_departement(params$code_departement)
```


\newpage
## Statistiques du département

```{r}
summary(df_departement)
```


\newpage
## Répartition des élus du département par catégorie socio-professionnelle

```{r}
plot_departement <- plot(df_departement)
plot_departement$graphique_sans_legende
plot_departement$legende
```


\newpage
# Conclusion

L’analyse met en évidence la composition des élus au niveau de la commune et du département ainsi que les écarts éventuels entre ces deux niveaux. Elle offre une vision structurée des âges et des catégories d’activité, utile pour observer les spécificités locales. Grâce à sa conception paramétrable, le rapport assure une production uniforme et reproductible des résultats pour toute commune et tout département du jeu de données.
